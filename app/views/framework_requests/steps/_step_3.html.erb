<%# school lookup for guests or selection for users (3) %>

<%= form.hidden_field :dsi, value: form.object.dsi  %>
<%= form.hidden_field :group, value: form.object.group %>

<% if current_user.guest? %>
  <%=
    if form.object.group
      render "framework_requests/steps/find_group", form: form
    else
      render "framework_requests/steps/find_school", form: form
    end
  %>
<% else %>
  <%= content_for :title, I18n.t("faf.user_organisation.header") %>

  <%= form.govuk_radio_buttons_fieldset(:org_id,
    caption: {
      text: I18n.t("faf.which_school.caption"),
      size: "l" },
    legend: {
      text: I18n.t("faf.which_school.legend"),
      size: "l"
    }) do %>
      <% form.object.user.supported_orgs.each do |org| %>

        <%# TODO: user presenter can unify school_urn and group_uid %>
        <% if org.group %>
          <%= form.govuk_radio_button :org_id, org.uid, label: { text: org.name }, group: org.group %>
        <% else %>
          <%= form.govuk_radio_button :org_id, org.urn, label: { text: org.name }, group: org.group %>
        <% end %>
      <% end %>
  <% end %>

  <%= javascript_include_tag "faf_select_school" %>
<% end %>

